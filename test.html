<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>WebSocket Parsing Example</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      margin: 20px;
    }
    button {
      padding: 10px 20px;
      font-size: 16px;
      margin: 10px;
      cursor: pointer;
    }
    #log {
      margin-top: 20px;
      padding: 10px;
      border: 1px solid #ccc;
      background-color: #f9f9f9;
      height: 150px;
      overflow-y: auto;
    }
  </style>
</head>
<body>
  <h1>WebSocket Parsing Example</h1>
  <button id="startParsingBtn">Start Parsing</button>
  <button id="endParsingBtn">Stop Parsing</button>

  <h2>Logs</h2>
  <div id="log"></div>

  <script>
    const socket = new WebSocket('ws://localhost:3000/ws');
    const logElement = document.getElementById('log');

    let parsing = false;
    let subscriptionId = 'YOUR_SUBSCRIPTION_ID'; // Replace with actual logic to get subscription ID

    // Function to log messages to the UI
    function logMessage(message) {
      const logEntry = document.createElement('div');
      logEntry.textContent = message;
      logElement.appendChild(logEntry);
      logElement.scrollTop = logElement.scrollHeight; // Auto-scroll to the bottom
    }

    // Handle WebSocket connection
    socket.onopen = () => {
      logMessage('WebSocket connected');
    };

    socket.onclose = () => {
      logMessage('WebSocket disconnected');
      if (parsing) {
        endParsing();
      }
    };

    socket.onerror = (error) => {
      logMessage(`WebSocket error: ${error.message}`);
    };

    socket.onmessage = (event) => {
      const data = JSON.parse(event.data);
      if (data.event === 'parsing_response') {
		console.log(data);
        if (data.data.success) {
          logMessage('Parsing started');
          // Start parsing logic
          setInterval(() => {
            if (parsing) {
              socket.send(JSON.stringify({ event: 'heartbeat', subscriptionId }));
            }
          }, 30000); // Heartbeat every 30 seconds
        } else {
          logMessage(`Parsing denied: ${data.message}`);
        }
      }
    };

    function startParsing() {
      parsing = true;
      socket.send(JSON.stringify({ event: 'parsing_start', subscriptionId }));
      logMessage('Request to start parsing sent');
    }

    function endParsing() {
      parsing = false;
      socket.send(JSON.stringify({ event: 'parsing_end', subscriptionId }));
      logMessage('Request to stop parsing sent');
    }

    // Add event listeners for parsing start and end
    document.getElementById('startParsingBtn').addEventListener('click', startParsing);
    document.getElementById('endParsingBtn').addEventListener('click', endParsing);
  </script>
</body>
</html>